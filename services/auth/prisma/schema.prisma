// prisma/schema.prisma

generator client {
  provider = "prisma-client"
  output   = "../src/infrastructure/database/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id     Int    @id @default(autoincrement())
  mobile String @unique()
  role   Role   @default(NewUser)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()

  userPermissions UserPermission[]
}

model UserPermission {
  id Int @id @default(autoincrement())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()

  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       Int
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  permissionId Int
}

model Permission {
  id   Int    @id @default(autoincrement())
  name String @unique()

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()

  UserPermissions UserPermission[]
}

model InboxEvent {
  id          Int              @id @default(autoincrement())
  queue       String
  routingKey  String
  serviceName String
  status      InboxEventStatus @default(PENDING)
  captureAt   DateTime         @default(now())
  handledAt   DateTime?
  error       String?
  payload     Json
}

model OutboxEvent {
  id         Int               @id @default(autoincrement())
  routingKey String
  status     OutboxEventStatus @default(PENDING)
  captureAt  DateTime          @default(now())
  handledAt  DateTime?
  error      String?
  payload    Json
}

// Enums-------------------------------------------------------------------------
enum InboxEventStatus {
  PENDING
  Handled
  Error
}

enum OutboxEventStatus {
  PENDING
  Handled
  Error
}

enum Role {
  Admin
  NewUser
  Customer
  Operator
}
