// prisma/schema.prisma

generator client {
  provider = "prisma-client"
  output   = "../src/infrastructure/database/generated/prisma"
}

datasource db {
  provider = "mysql"
}

//Tables---------------------------------------------------------------------
model Factor {
  id           Int          @id @default(autoincrement())
  factorNumber String       @unique
  orderId      Int
  status       FactorStatus @default(DRAFT)
  issuedAt     DateTime     @default(now())
  dueAt        DateTime?
  totalPrice   Float
  description  String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  customer   CustomerReference @relation(fields: [customerId], references: [id])
  customerId Int

  items    FactorItem[]
  payments Payment[]
}

model FactorItem {
  id          Int    @id @default(autoincrement())
  description String
  quantity    Int    @default(1)
  unitPrice   Float
  totalPrice  Float // quantity * unitPrice

  factor   Factor @relation(fields: [factorId], references: [id], onDelete: Cascade)
  factorId Int

  service   ServiceReference @relation(fields: [serviceId], references: [id])
  serviceId Int
}

model Payment {
  id            Int           @id @default(autoincrement())
  amount        Float
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String // From payment gateway (e.g., Stripe, PayPal)
  paidAt        DateTime?
  description   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  factor   Factor @relation(fields: [factorId], references: [id], onDelete: Cascade)
  factorId Int
}

//Reference Tables--------------------------------------------------------
model CustomerReference {
  id           Int    @id @default(autoincrement())
  firstName    String
  lastName     String
  nationalCode String
  mobile       String
  email        String

  factors Factor[]
}

model ServiceReference {
  id    Int    @id @default(autoincrement())
  name  String
  price Float

  factorItems FactorItem[]
}

// Enums---------------------------------------------------------------
enum FactorStatus {
  DRAFT
  ISSUED
  PAID
  PARTIALLY_PAID
  OVERDUE
  CANCELLED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  BANK_TRANSFER
  ONLINE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}
