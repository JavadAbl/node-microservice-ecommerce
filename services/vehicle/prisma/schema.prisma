// prisma/schema.prisma

generator client {
  provider = "prisma-client"
  output   = "../src/infrastructure/database/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Vehicle {
  id           Int               @id @default(autoincrement())
  vin          String            @unique
  make         String
  model        String
  year         Int
  trim         String?
  fuelType     FuelType?
  transmission TransmissionType?
  engine       String?
  color        String?
  mileage      Int?
  licensePlate String?
  state        String?
  status       VehicleStatus     @default(Active)
  isDeleted    Boolean           @default(false)
  description  String?

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  services VehicleService[]

  customer   CustomerReference @relation(fields: [customerId], references: [id])
  customerId Int
}

model VehicleService {
  id               Int      @id @default(autoincrement())
  serviceDate      DateTime
  mileageAtService Int
  technicianName   String
  description      String?

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  vehicleId Int

  service   ServiceReference @relation(fields: [serviceId], references: [id])
  serviceId Int
}

//Reference Tables--------------------------------------------------------
model CustomerReference {
  id           Int    @id @default(autoincrement())
  firstName    String
  lastName     String
  nationalCode String
  mobile       String
  email        String

  vehicles Vehicle[]
}

model ServiceReference {
  id    Int    @id @default(autoincrement())
  name  String
  price Float

  vehicleServiceHistories VehicleService[]
}

model InboxEvent {
  id          Int              @id @default(autoincrement())
  queue       String
  serviceName String
  status      InboxEventStatus @default(PENDING)
  handledAt   DateTime?
  payload     Json
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

// Enums-------------------------------------------------------------------------
enum InboxEventStatus {
  PENDING
  Handled
  Error
}

enum FuelType {
  Gasoline
  Diesel
  Electric
  Hybrid
  PlugInHybrid
  Hydrogen
  Other
}

enum TransmissionType {
  Automatic
  Manual
  CVT
  DualClutch
  Robotic
  Other
}

enum VehicleStatus {
  Active
  InRepair
  ReadyForPickup
  Archived
  UnderWarranty
  InService
  OnLoan
  NotOperational
}
